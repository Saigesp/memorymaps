<!DOCTYPE html lang="es-ES" >
<html>

    <head>
        <title>La ruta del dinero - Instituto 25M</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">

        <meta property="og:title" content="La ruta del dinero - Instituto 25M" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="" />
        <meta property="og:image" content="" />
        <meta property="og:description" content="" />
        <meta property="og:site_name" content="" />
        <meta property="og:locale" content="es_ES" />
        <meta property="article:publisher" content="">

        <!-- styles -->
        <link rel="stylesheet" href="assets/css/style.css">

        <!-- schema.org markup for Google+ -->
        <meta itemprop="name" content="La ruta del dinero - Instituto 25M" >
        <meta itemprop="description" content="">
        <meta itemprop="image" content="">

        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="">
        <meta name="twitter:title" content="La ruta del dinero - Instituto 25M">
        <meta name="twitter:description" content="">
        <meta name="twitter:creator" content="">
        <meta name="twitter:image:src" content="">

    </head>

    <style>
        #map {
            position: fixed;
            z-index: -1;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        #sections {
            overflow: auto;
        }
        .section-wrap {
            width: 100%;
            max-width: 600px;
            margin: 100px auto;
        }
        .section{
            padding: 0 40px;
            margin-bottom: 600px;
        }
        .section h1{
        }
    </style>

    <body>
        <div id="map"></div>
        <main id="sections">
            <div class="section-wrap">
            </div>
        </main>
    </body>

    <!-- scripts -->
    <script src="assets/js/bundle.js"></script>
    <script type="text/javascript">

        d3.xml('assets/img/world.svg').then(world => {
            d3.json('assets/data/data.json').then(function(data){

                d3.select('#map').node().append(world.documentElement);

                var svg = d3.select('#world')

                var zoom = d3.zoom().on('zoom', function() {
                        canvas.attr('transform', d3.event.transform);
                    })
                var canvas = svg.call(zoom)

                var sections = d3.select('.section-wrap').selectAll('.section')
                    .data(data.stories).enter()
                    .append('section')
                    .attr('class', 'section')
                    .attr('style', 'margin-bottom:'+(window.innerHeight*4/5)+'px')

                sections.append('h1').text(function(d){ return d.title }).attr('style', 'margin-top:'+(window.innerHeight/2)+'px')
                sections.append('div').html(function(d){ return d.text })

                function centerPoint(x,y,scale=1,duration=1500){
                    zoom.transform(svg.transition().duration(duration),
                        d3.zoomIdentity.scale(scale)
                        .translate(
                            ((-x*scale)+((scale-1)*1000)+(window.innerWidth/2))/scale,
                            ((((-y+1000)*scale)-(((scale-1)*500)+1000))+window.innerHeight/2)/scale
                        )
                    );
                }

                d3.graphScroll()
                    .sections(d3.selectAll('.section'))
                    .on('active', function(i){
                        console.log(i + 'th section active')
                        centerPoint(data.stories[i].x,data.stories[i].y,data.stories[i].scale,data.stories[i].duration)
                    })

            })
        })
    </script>
    <!-- end scripts -->

</html>